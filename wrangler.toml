name = "huepress-api"
main = "src/api/index.ts"
compatibility_date = "2024-12-18"

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "huepress-db"
database_id = "53c9b8ee-8ac3-411f-9f09-abe402cc36ff"

# R2 Storage - Private (PDFs for subscribers)
[[r2_buckets]]
binding = "ASSETS_PRIVATE"
bucket_name = "huepress-assets-private"

# R2 Storage - Public (Watermarked previews)
[[r2_buckets]]
binding = "ASSETS_PUBLIC"
bucket_name = "huepress-assets-public"

# Environment variables (set via wrangler secret)
# CLERK_SECRET_KEY
# STRIPE_SECRET_KEY
# STRIPE_WEBHOOK_SECRET
# META_ACCESS_TOKEN
# PINTEREST_ACCESS_TOKEN
# GA4_API_SECRET

[vars]
ENVIRONMENT = "production"
API_URL = "https://api.huepress.co"
META_PIXEL_ID = "1588901548777498"
ADMIN_EMAILS = "marcell@neongod.io"
SITE_URL = "https://huepress.co"
ASSETS_CDN_URL = "https://assets.huepress.co"
PINTEREST_AD_ACCOUNT_ID = "549769812316"
GA4_MEASUREMENT_ID = "G-QTF6MPM5SQ"

# Pages configuration
pages_build_output_dir = "dist"


# Cloudflare Container for resource-intensive processing
[[containers]]
class_name = "ProcessingContainer"
image = "./container/Dockerfile"
max_instances = 3

# Container Durable Object binding
[[durable_objects.bindings]]
class_name = "ProcessingContainer"
name = "PROCESSING"

# Container migration
[[migrations]]
new_sqlite_classes = ["ProcessingContainer"]
tag = "v1"
